 # Refactor & Improvement Game Plan for Ensemble Pipeline

This plan is tailored to your current codebase and project structure. Each step is actionable and references specific files, folders, and patterns found in your project.

---

## 1. Codebase Audit & Cleanup
- **Remove Unused Functions:**
  - Audit all files in `helpers/`, `app/`, and `run.py` for functions that are defined but never called.
  - Remove dead code, old scripts, and unused imports.
  - Use IDE/refactoring tools or static analysis (e.g., `vulture`, `flake8`) to help identify unused code.

## 2. Folder Layout Improvements
- **Adopt/Enforce a Full Stack Structure:**
  - **Backend:**
    - Move all core ML/data logic to a `backend/` directory (e.g., `backend/helpers/`, `backend/config.py`, `backend/run.py`).
    - Expose model training, prediction, and data endpoints via a REST API (e.g., using FastAPI or Flask in `backend/api/`).
    - Keep all data I/O, model logic, and utility code in `backend/`.
  - **Frontend:**
    - Place all UI code in a `frontend/` directory (e.g., `frontend/` keep Streamlit in `frontend/` 
    - If using Streamlit, move `app/` to `frontend/streamlit/` and update imports accordingly.
    - Frontend should communicate with backend via API calls (not via file system or CSVs).
  - **Shared Code:**
    - If you have code shared between frontend and backend (e.g., data schemas, validation), place it in a `shared/` directory.
  - **Data and Output:**
    - Keep `data/` for raw input and `output/` for results, but restrict direct access to backend only.
  - **Tests:**
    - Create a `tests/` directory at the root for all unit/integration tests, with subfolders for backend and frontend tests as needed.
  - **Example Structure:**
    ```
    /backend
      /api
      /helpers
      config.py
      run.py
    /frontend
      /streamlit  # or /react, /vue, etc.
      ...
    /shared
      schemas.py
      utils.py
    /data
    /output
    /tests
      /backend
      /frontend
    requirements.txt
    README.md
    ```
- **Action Items:**
  - Plan and execute migration of code into this structure.
  - Update all imports and documentation to reflect new layout.
  - Ensure all communication between frontend and backend is via API, not file system.

## 3. Refactor K-Fold Logic to Use scikit-learn
- **Replace Custom K-Fold Logic:**
  - In `helpers/data.py` and `run.py`, ensure all cross-validation uses `sklearn.model_selection.KFold` or `StratifiedKFold` directly.
  - In `helpers/modeling.py`, use `cross_val_score` or `cross_validate` for model evaluation where possible.
  - Remove or refactor any custom split logic that duplicates scikit-learn functionality.

## 4. Frontend-Backend Integration (Remove CSV Intermediaries)
- **Eliminate CSV-based Communication:**
  - In `app/tabs.py`, `app/utils.py`, and `helpers/export_metrics_for_streamlit.py`, replace all `pd.read_csv`/`to_csv` calls used for frontend-backend data transfer with in-memory data passing (e.g., via function calls, shared objects, or direct API calls if you move to a microservice architecture).
  - For user-uploaded data, keep CSV upload for user input, but process in-memory after upload.
  - For model results, pass data as Python objects or JSON, not as intermediate CSV files in `output/streamlit_data/`.

## 5. Remove matplotlib
- **Backend:**
  - Remove all `matplotlib` imports and usage from `run.py` and `helpers/plotting.py`.
  - Refactor plotting functions to return raw data (arrays, metrics) or save plots using a frontend-compatible format (e.g., Plotly JSON, or return data for frontend rendering).
- **Frontend:**
  - Use Streamlit's built-in charting or integrate with Plotly for interactive visualizations in `app/tabs.py`.
  - Remove any code that loads or displays static PNGs generated by matplotlib.

## 6. Testing & Documentation
- **Add/Update Tests:**
  - If not present, create a `tests/` directory and add unit tests for all major functions in `helpers/` and `app/`.
  - Use `pytest` or `unittest` for test automation.
- **Update Documentation:**
  - Update `README.md` to reflect new data flow (no CSV intermediaries, new folder structure, etc.).
  - Add docstrings to all new/refactored functions.

---

## Immediate Action Items
1. Run a static analysis tool to find unused functions and imports.
2. List all CSV read/write operations and plan their removal or replacement.
3. List all matplotlib usages and plan their removal or replacement.
4. Refactor K-Fold logic to use scikit-learn utilities everywhere.
5. Plan and implement a new data flow for frontend-backend integration (no CSVs).
6. Add or update tests and documentation as you refactor.

---

## References to Update
- `run.py`, `helpers/plotting.py`, `helpers/export_metrics_for_streamlit.py`, `app/tabs.py`, `app/utils.py`, `config.py`, and any other file using CSV or matplotlib.

---

**This plan is actionable and tailored to your current codebase. Tackle each section iteratively, testing as you go.** 